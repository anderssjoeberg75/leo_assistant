<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jarvis Robot</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
  touch-action: none;
}

#video {
  width: 100%;
  max-width: 640px;
  border-bottom: 2px solid #333;
}

.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-top: 15px;
}

.arrows {
  display: grid;
  grid-template-columns: 80px 80px 80px;
  grid-template-rows: 80px 80px 80px;
  gap: 10px;
}

button {
  background: #333;
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 26px;
}

button:active { background: #666; }

#speed {
  -webkit-appearance: slider-vertical;
  width: 40px;
  height: 260px;
}
</style>
</head>
<body>

<img id="video" src="http://YOUR_PI_IP:8888">

<div class="controls">
  <div class="arrows">
    <div></div>
    <button id="fwd">⬆️</button>
    <div></div>

    <button id="left">⬅️</button>
    <button id="stop">⏹️</button>
    <button id="right">➡️</button>

    <div></div>
    <button id="back">⬇️</button>
    <div></div>
  </div>

  <input id="speed" type="range" min="10" max="100" value="50">
</div>

<br>
<button onclick="restart()">Restart Jarvis</button>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let speed = 0.5;
let steering = 0;

const speedSlider = document.getElementById('speed');
speedSlider.oninput = () => speed = speedSlider.value / 100;

function send() {
  socket.emit('drive', { speed, steering });
}

function halt() {
  socket.emit('drive', { speed: 0, steering: 0 });
}

document.getElementById('fwd').ontouchstart = () => { steering = 0; send(); };
document.getElementById('back').ontouchstart = () => { steering = 0; send(); speed = -Math.abs(speed); send(); };
document.getElementById('left').ontouchstart = () => { steering = -0.6; send(); };
document.getElementById('right').ontouchstart = () => { steering = 0.6; send(); };
document.getElementById('stop').ontouchstart = halt;

['fwd','back','left','right','stop'].forEach(id => {
  document.getElementById(id).ontouchend = halt;
});

function restart() {
  fetch('/restart', { method: 'POST' });
}
</script>

</body>
</html>
